---
import { getCollection } from "astro:content";
import Note from "./Note.astro";

const collection = await getCollection("notes");
const sorted = collection.sort(
  (a, b) => new Date(b.data.date).getTime() - new Date(a.data.date).getTime(),
);

const url = Astro.url;
const tag = url.searchParams.get("tag");

const notes = tag
  ? sorted.filter((note) => note.data.tags?.includes(tag))
  : sorted;
---

{notes.map((note) => <Note note={note} />)}
